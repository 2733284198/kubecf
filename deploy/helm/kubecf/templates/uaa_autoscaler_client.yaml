{{- if .Values.features.autoscaler.enabled -}}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Release.Name }}.var-cf-client-id
  namespace: {{ .Release.Namespace | quote }}
type: Opaque
stringData:
  value: app_autoscaler
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: ops-uaa-autoscaler-client
  namespace: {{ .Release.Namespace | quote }}
  labels:
    app.kubernetes.io/instance: {{ .Release.Name | quote }}
    app.kubernetes.io/managed-by: {{ .Release.Service | quote }}
    app.kubernetes.io/name: {{ include "kubecf.fullname" . }}
    app.kubernetes.io/version: {{ default .Chart.Version .Chart.AppVersion | quote }}
    helm.sh/chart: {{ include "kubecf.chart" . }}
data:
  ops: |
    - type: replace
      path: /instance_groups/name=uaa/jobs/name=uaa/properties/uaa/clients?/app_autoscaler
      value:
        authorities: cloud_controller.read,cloud_controller.admin,uaa.resource
        authorized-grant-types: client_credentials
        scope: cloud_controller.read,cloud_controller.write,openid,scim.read
        secret: ((cf_client_secret))
    - type: replace
      path: /variables/-
      value:
        name: cf_client_secret
        type: password
{{- end }}
