{{- $_ := include "_config.load" $ }}
{{- if .Values.features.eirini.enabled }}
{{- if not .Values.bits.useExistingSecret }}
{{- if not (hasKey .Values.bits.secrets "BITS_TLS_CRT") }}
_needsTlsCrt: {{ fail "secrets.BITS_TLS_CRT must be set" }}
{{- end }}
{{- if not (hasKey .Values.bits.secrets "BITS_TLS_KEY") }}
_needsTlsKey: {{ fail "secrets.BITS_TLS_KEY must be set" }}
{{- end }}
# Certificate
---
apiVersion: v1
data:
  tls.crt: {{ .Values.bits.secrets.BITS_TLS_CRT | b64enc }}
  tls.key: {{ .Values.bits.secrets.BITS_TLS_KEY | b64enc }}
kind: Secret
metadata:
  name: {{ .Values.bits.tls_secret_name }}
type: Opaque
{{- end }}
{{- end }}
